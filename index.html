<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>:root { --bg-color: #ffffff; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>* {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>body, .moodboard {</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-family: 'Montserrat', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #f5f5f5;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 20px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls, .ratios {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls label {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 10px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls input[type=range],</p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls button,</p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls select {</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 6px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: 1px solid #ccc;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #eee;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: #000;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.switch-btn, .scale-btn {</p>
<p class="p1"><span class="Apple-converted-space">    </span>min-width: 50px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 40px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.scale-btn.active {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #ccc;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.moodboard {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--bg-color);</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>max-width: 1400px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: 0 8px 20px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.canvas-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding-top: 75%; /* 4:3 aspect ratio */</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1">#canvas {</p>
<p class="p1"><span class="Apple-converted-space">  </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">  </span>top: 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>left: 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">  </span>inset: 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">  </span>flex-direction: column;</p>
<p class="p1">}</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>#canvas:empty::before {</p>
<p class="p1"><span class="Apple-converted-space">  </span>content: '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">  </span>height: 100%;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">.grid {</p>
<p class="p1"><span class="Apple-converted-space">  </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">  </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">  </span>height: auto;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>min-height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">  </span>gap: var(--gap, 20px);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.grid-column, .grid-row {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: var(--gap, 20px);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.grid-column {</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.grid-row {</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: row;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.grid-item {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #ddd;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--radius,20px);</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.img-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: grab;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-repeat: no-repeat;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-position: center center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-size: 100% auto;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.file-input {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">    </span>top: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>left: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>opacity: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div class="moodboard"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Colonnes&lt;input type="range" id="colSlider" min="1" max="5" value="3"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Lignes&lt;input type="range" id="rowSlider" min="1" max="4" value="3"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Espacement&lt;input type="range" id="gapSlider" min="0" max="50" value="20"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Arrondi&lt;input type="range" id="radiusSlider" min="0" max="50" value="20"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Décalage&lt;input type="range" id="offsetAmount" min="0" max="1" step="1" value="0"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button class="switch-btn" id="offsetTypeBtn"&gt;Horizontal&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Marges (px)&lt;input type="range" id="marginSlider" min="0" max="100" value="0"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;Fond&lt;input type="color" id="bgColorPicker" value="#ffffff"&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="undoBtn"&gt;⟲ Retour&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="redoBtn"&gt;⟲ Avancer&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;span&gt;Echelle :&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="scale-btn active" data-scale="1"&gt;1x&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="scale-btn" data-scale="2"&gt;2x&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="scale-btn" data-scale="3"&gt;3x&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="scale-btn" data-scale="4"&gt;4x&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;select id="formatSelect"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="png"&gt;PNG&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="jpg"&gt;JPG&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="webp"&gt;WEBP&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="pdf"&gt;PDF&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="downloadBtn"&gt;Télécharger&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="ratios"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button onclick="setRatio(4,3)"&gt;4:3&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button onclick="setRatio(1,1)"&gt;1:1&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button onclick="setRatio(3,4)"&gt;3:4&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button onclick="setRatio(4,2)"&gt;4:2&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button onclick="setRatio(16,9)"&gt;16:9&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="canvas-wrapper"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="canvas"&gt;&lt;div class="grid" id="grid"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"&gt;&lt;/script&gt;</p>
<p class="p1">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"&gt;&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">let historyStates = [], historyIndex = -1, exportScale = 1, offsetType = 'horizontal';</p>
<p class="p1">const grid = document.getElementById('grid'), canvas = document.getElementById('canvas');</p>
<p class="p1">const colSlider = document.getElementById('colSlider'), rowSlider = document.getElementById('rowSlider');</p>
<p class="p1">const gapSlider = document.getElementById('gapSlider'), radiusSlider = document.getElementById('radiusSlider');</p>
<p class="p1">const offsetSlider = document.getElementById('offsetAmount'), marginSlider = document.getElementById('marginSlider');</p>
<p class="p1">const bgPicker = document.getElementById('bgColorPicker');</p>
<p class="p1">const undoBtn = document.getElementById('undoBtn'), redoBtn = document.getElementById('redoBtn');</p>
<p class="p1">const offsetBtn = document.getElementById('offsetTypeBtn');</p>
<p class="p1">const scaleBtns = document.querySelectorAll('.scale-btn');</p>
<p class="p1">const fmtSelect = document.getElementById('formatSelect'), dlBtn = document.getElementById('downloadBtn');</p>
<p class="p2"><br></p>
<p class="p1">function saveState(){ historyStates=historyStates.slice(0,historyIndex+1); historyStates.push(grid.innerHTML); historyIndex=historyStates.length-1; }</p>
<p class="p2"><br></p>
<p class="p1">bgPicker.addEventListener('input', ()=&gt; document.documentElement.style.setProperty('--bg-color', bgPicker.value));</p>
<p class="p1">[gapSlider,radiusSlider].forEach(s=&gt; s.addEventListener('input', ()=&gt;{ document.documentElement.style.setProperty(`--${s.id.replace('Slider','')}`, s.value+'px'); createGrid(); }));</p>
<p class="p1">[colSlider,rowSlider,offsetSlider,marginSlider].forEach(s=&gt; s.addEventListener('input', createGrid));</p>
<p class="p2"><br></p>
<p class="p1">undoBtn.addEventListener('click', ()=&gt;{ if(historyIndex&gt;0) grid.innerHTML=historyStates[--historyIndex]; });</p>
<p class="p1">redoBtn.addEventListener('click', ()=&gt;{ if(historyIndex&lt;historyStates.length-1) grid.innerHTML=historyStates[++historyIndex]; });</p>
<p class="p1">offsetBtn.addEventListener('click', ()=&gt;{ offsetType=offsetType==='horizontal'?'vertical':'horizontal'; offsetBtn.textContent=offsetType.charAt(0).toUpperCase()+offsetType.slice(1); createGrid(); });</p>
<p class="p1">scaleBtns.forEach(btn=&gt; btn.addEventListener('click', ()=&gt;{ scaleBtns.forEach(b=&gt;b.classList.remove('active')); btn.classList.add('active'); exportScale=+btn.dataset.scale; }));</p>
<p class="p1">function setRatio(w,h){ document.querySelector('.canvas-wrapper').style.paddingTop = `${(h/w)*100}%`; }</p>
<p class="p2"><br></p>
<p class="p1">function createCell(parent) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const radius = +radiusSlider.value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const item = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">  </span>item.className = 'grid-item';</p>
<p class="p1"><span class="Apple-converted-space">  </span>item.style.borderRadius = radius + 'px';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const wrapper = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.className = 'img-wrapper';</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.dataset.posX = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.dataset.posY = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.dataset.scale = 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.dataset.ratio = 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const input = document.createElement('input');</p>
<p class="p1"><span class="Apple-converted-space">  </span>input.type = 'file';</p>
<p class="p1"><span class="Apple-converted-space">  </span>input.accept = 'image/*';</p>
<p class="p1"><span class="Apple-converted-space">  </span>input.className = 'file-input';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let isDragging = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let startX, startY, baseX, baseY;</p>
<p class="p1"><span class="Apple-converted-space">  </span>function onMouseDown(e) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!wrapper.style.backgroundImage) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>isDragging = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>startX = e.clientX;</p>
<p class="p1"><span class="Apple-converted-space">    </span>startY = e.clientY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>baseX = +wrapper.dataset.posX;</p>
<p class="p1"><span class="Apple-converted-space">    </span>baseY = +wrapper.dataset.posY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.cursor = 'grabbing';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function onMouseUp() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>isDragging = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.cursor = 'grab';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function onMouseMove(e) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isDragging) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dx = e.clientX - startX;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dy = e.clientY - startY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let x = baseX + dx;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let y = baseY + dy;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sc = +wrapper.dataset.scale;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const r = +wrapper.dataset.ratio;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const w = wrapper.clientWidth;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const h = wrapper.clientHeight;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let sw = w * sc;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let sh = sw * r;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (sh &lt; h * sc) { sh = h * sc; sw = sh / r; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>const maxX = (sw - w) / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const maxY = (sh - h) / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>x = Math.max(-maxX, Math.min(maxX, x));</p>
<p class="p1"><span class="Apple-converted-space">    </span>y = Math.max(-maxY, Math.min(maxY, y));</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.posX = x;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.posY = y;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.backgroundPosition = `calc(50% + ${x}px) calc(50% + ${y}px)`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function onWheel(e) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">    </span>let sc = +wrapper.dataset.scale;</p>
<p class="p1"><span class="Apple-converted-space">    </span>sc += e.deltaY &lt; 0 ? 0.1 : -0.1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>sc = Math.min(5, Math.max(1, sc));</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.scale = sc;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.backgroundSize = `${sc*100}% auto`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const x = +wrapper.dataset.posX;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const y = +wrapper.dataset.posY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.backgroundPosition = `calc(50% + ${x}px) calc(50% + ${y}px)`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function onDoubleClick() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.style.backgroundImage = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.posX = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.posY = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.scale = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrapper.dataset.ratio = 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function onInputChange() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const file = input.files[0];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!file || !file.type.startsWith('image/')) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const reader = new FileReader();</p>
<p class="p1"><span class="Apple-converted-space">    </span>reader.onload = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const img = new Image();</p>
<p class="p1"><span class="Apple-converted-space">      </span>img.src = reader.result;</p>
<p class="p1"><span class="Apple-converted-space">      </span>img.onload = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.dataset.ratio = img.height / img.width;</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.style.backgroundImage = `url(${reader.result})`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.dataset.scale = 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.dataset.posX = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.dataset.posY = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.style.backgroundSize = '100% auto';</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.style.backgroundPosition = '50% 50%';</p>
<p class="p1"><span class="Apple-converted-space">        </span>wrapper.removeEventListener('click', onWrapperClick);</p>
<p class="p1"><span class="Apple-converted-space">        </span>input.removeEventListener('change', onInputChange);</p>
<p class="p1"><span class="Apple-converted-space">        </span>input.remove();</p>
<p class="p1"><span class="Apple-converted-space">        </span>saveState();</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>reader.readAsDataURL(file);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function onWrapperClick() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>input.click();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.addEventListener('click', onWrapperClick);</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.addEventListener('mousedown', onMouseDown);</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.addEventListener('mouseup', onMouseUp);</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.addEventListener('mousemove', onMouseMove);</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.addEventListener('wheel', onWheel);</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrapper.addEventListener('dblclick', onDoubleClick);</p>
<p class="p1"><span class="Apple-converted-space">  </span>input.addEventListener('change', onInputChange);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>item.append(wrapper, input);</p>
<p class="p1"><span class="Apple-converted-space">  </span>parent.append(item);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function createGrid(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>grid.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const cols=+colSlider.value, rows=+rowSlider.value, gap=+gapSlider.value, off=+offsetSlider.value, margin=+marginSlider.value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.documentElement.style.setProperty('--gap',gap+'px');</p>
<p class="p1"><span class="Apple-converted-space">  </span>canvas.style.borderRadius=radiusSlider.value+'px';</p>
<p class="p1"><span class="Apple-converted-space">  </span>canvas.style.padding=margin+'px';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(offsetType==='vertical'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>grid.style.flexDirection='row';</p>
<p class="p1"><span class="Apple-converted-space">    </span>for(let c=0;c&lt;cols;c++){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const col=document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">      </span>col.className='grid-column';</p>
<p class="p1"><span class="Apple-converted-space">      </span>col.style.gap=gap+'px';</p>
<p class="p1"><span class="Apple-converted-space">      </span>let count=rows;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(off&amp;&amp;c!==Math.floor(cols/2)) count--;</p>
<p class="p1"><span class="Apple-converted-space">      </span>for(let i=0;i&lt;count;i++) createCell(col);</p>
<p class="p1"><span class="Apple-converted-space">      </span>grid.append(col);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>grid.style.flexDirection='column';</p>
<p class="p1"><span class="Apple-converted-space">    </span>for(let r=0;r&lt;rows;r++){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const row=document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">      </span>row.className='grid-row';</p>
<p class="p1"><span class="Apple-converted-space">      </span>row.style.gap=gap+'px';</p>
<p class="p1"><span class="Apple-converted-space">      </span>let count=cols;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(off&amp;&amp;r!==Math.floor(rows/2)) count--;</p>
<p class="p1"><span class="Apple-converted-space">      </span>for(let i=0;i&lt;count;i++) createCell(row);</p>
<p class="p1"><span class="Apple-converted-space">      </span>grid.append(row);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>saveState();</p>
<p class="p1">}</p>
<p class="p1">createGrid();</p>
<p class="p2"><br></p>
<p class="p1">dlBtn.addEventListener('click', async ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cnv=await html2canvas(canvas,{scale:exportScale});</p>
<p class="p1"><span class="Apple-converted-space">    </span>const fmt=fmtSelect.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(fmt==='pdf'){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const img=cnv.toDataURL('image/png');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const{jsPDF}=window.jspdf;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const doc=new jsPDF({unit:'px',format:[cnv.width,cnv.height]});</p>
<p class="p1"><span class="Apple-converted-space">      </span>doc.addImage(img,'PNG',0,0,cnv.width,cnv.height);</p>
<p class="p1"><span class="Apple-converted-space">      </span>doc.save('moodboard.pdf');</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>cnv.toBlob(blob=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">        </span>if(!blob){ alert('Erreur: impossible de générer le fichier'); return; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>const url=URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const link=document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">        </span>link.href=url;</p>
<p class="p1"><span class="Apple-converted-space">        </span>link.download=`moodboard.${fmt}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.body.append(link);</p>
<p class="p1"><span class="Apple-converted-space">        </span>link.click();</p>
<p class="p1"><span class="Apple-converted-space">        </span>link.remove();</p>
<p class="p1"><span class="Apple-converted-space">        </span>URL.revokeObjectURL(url);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, fmt==='jpg'?'image/jpeg':`image/${fmt}`);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}catch(e){ console.error(e); alert('Échec export, réessayez'); }</p>
<p class="p1">});</p>
<p class="p1">&lt;/script&gt;</p>
</body>
</html>
